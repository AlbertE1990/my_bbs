{% extends "cms/iframe_base.html" %}
{% block title %}权限管理{% endblock %}
{% block styles %}
  {{ super() }}
  <style>
  .checkbox{
  display:block;
  }
  </style>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script>
  $(function () {

      $('.btn-per').click(function (e) {
          e.preventDefault();
          var uid = $(this).attr('data-user');
          var url = '/permission/'+uid;
          var per;
          myajax.get(
              {'url':url,
              'success':function (data) {
                  if (data.code == 200 ){
                      per = data.data;
                      $('.checkbox input').prop('checked',false);
                      $.each(per, function (k, v) {
                          console.log(k,v);
                          $('.checkbox input[name={0}]'.format(k)).prop('checked',v);
                      });
                      $('#myModal').modal('show');

                  }else{
                      xtalert.alertErrorToast(data.message)
                  }
              },

          });
      });
      function show_permission(per) {
          var per =0
      }
  })
  </script>
{% endblock %}
{% block content %}
  <div class="content container" >
    <div class="row">
      <div class="col-sm-8">
        <div class="widget">
          <div class="widget-header"> <i class="icon-table"></i>
            <h3>CMS用户</h3>
          </div>
          <div class="widget-content">
            <div class="body">
              <table class="table table-striped table-images">
                <thead>
                <tr>
                  <th></th>
                  <th>头像</th>
                  <th>姓名</th>
                  <th>角色</th>
                  <th>邮箱</th>
                  <th class="hidden-xs">Date</th>
                </tr>
                </thead>
                <tbody>
                {% for user in users %}

                  <tr class="center-block">
                    <td>{{ loop.index }}</td>
                    <td><img src="{{ user.avatar }}"></td>
                    <td> {{ user.realname }} </td>
                    <td> {{ user.role.name }} </td>
                    <td> {{ user.email }} </td>
                    <td class="hidden-xs">
                    <button type="button" class="btn btn-primary btn-sm btn-per" data-toggle="modal" data-target="#myModal" data-user={{ user.id }}>权限管理</button>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">权限</h4>
        </div>
        <div class="modal-body">
          <div class="checkbox">
            <label>
              <input type="checkbox" name="LOGIN" value="1">LOGIN
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="VIEW_POST" value="2">
              VIEW_POST
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="PUBLISH_POST" value="4">
              PUBLISH_POST
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="PUBLISH_COMMENT" value="8">
              PUBLISH_COMMENT
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="LOGIN_CMS" value="16">
              LOGIN_CMS
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="MANAGE_POST" value="32">
              MANAGE_POST
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="MANAGE_COMMENTE" value="64" checked>
              MANAGE_COMMENTE
            </label>
          </div>
          <div class="checkbox disabled">
            <label>
              <input type="checkbox" name="BOARDER" value="128" disabled>
              BOARDER
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="BANNER" value="256">
              BANNER
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="FRONTUSER" value="512">
              FRONTUSER
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="CMSUSER" value="1204">
              CMSUSER
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="ADMINER" value="2048">
              ADMINER
            </label>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox" name="ALL_PERMISSION" value="4095">
              ALL_PERMISSION
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          <button type="button" class="btn btn-primary">保存</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

